<!doctype html>
<html lang="en">
  <head>
    {% load static %}
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="theme-color" content="#007bff">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Google font and icon -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- My CSS -->
    <link rel="stylesheet" href="{% static 'css/style_manager.css' %}">

    <link rel="manifest" href="{% static 'attendance/manifest.json' %}">
      
    <!-- Title Start -->
    <title>{% block title %}{% endblock %}</title>
    <!-- Title End -->
  </head>
  <body>
    
    <!-- Navbar Start -->              
    <nav class="navbar navbar-dark bg-primary">
        <a href="/more">
            <i class="material-icons" style="color: white; font-size: 30px;">arrow_back</i>
          </a>
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="/logout">Keluar</a>
          </li>
        </ul>
    </nav>

    <div class="jumbotron jumbotron-fluid bg-primary" style="height: 25px; border-bottom-left-radius: 45px 30px; border-bottom-right-radius: 45px 30px;">
        <h5 class="text-center text-white" style="margin-top: -25px;">DATA MEMBER</h5>
    </div>

    <!-- Navbar End -->


    <!-- Body -->

    <div class="container" style="margin-top: -15px;">
      <div class="card" style="border-radius: 20px;">
          <div class="card-body">
          <h5 class="card-title text-primary text-center">HARI INI SAKIT</h5>
          <hr>
          <div>
            {% if sick_name|length == 0 %}
            <div style="border-radius: 30px;" class="alert alert-primary text-center" role="alert">
              Tidak ada yang sakit
            </div>
            {% else %}
            <table class="table table-striped">
              <tbody>
                {% for i in sick_name %}
                <tr>
                    <th scope="row">{{ forloop.counter }}</th>
                    <td>{{ i }}</td>
                </tr>
                {% endfor %}
                </tbody>
                {% endif %}
            </table>
          </div>
          </div>
      </div>
    </div>

    <div class="container" style="margin-top: 15px;">
        <div class="card" style="border-radius: 20px;">
            <div class="card-body">
            <h5 class="card-title text-primary text-center">DATA MEMBER</h5>
            <hr>
            {% if attendance|length == 0 %}
            <div style="border-radius: 30px;" class="alert alert-primary text-center" role="alert">
              Tidak ada data
            </div>
            {% else %}
            <div style="overflow-y: auto; height: 500px; overflow-x: auto;">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Inisial</th>
                        <th scope="col">Tanggal</th>
                        <th scope="col">Status</th>
                        <th scope="col">Kesehatan</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for data in attendance %}
                    <tr>
                        <th scope="row">{{ forloop.counter }}</th>
                        <td>{{ data.authors }}</td>
                        <td>{{ data.created_at | date:'Y-m-d' }}</td>
                        <td>{{ data.work_status }}</td>
                        <td>{{ data.condition }}</td> 
                        <td><h5><a onclick="getMember({{ data.id }}); slideShows()" class="badge badge-primary text-white">Detail</a></h5></td> 
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
              </div>
              <br>
              <button style="border-radius: 30px;" type="submit" class="btn btn-outline-primary btn-block btn-lg">Download</button>
              {% endif %}

            </div>
        </div>
    </div>

    <div class="container" style="margin-top: 15px;">
      <div class="card" style="border-radius: 20px;">
          <div class="card-body">
            <h5 class="card-title text-primary text-center">DATA KESEHATAN & KEHADIRAN</h5>
            <hr>
            {% if attendance|length == 0 %}
            <div style="border-radius: 30px;" class="alert alert-primary text-center" role="alert">
              Tidak ada data
            </div>
            {% else %}
            <div class="chart">
                <canvas id="myCharts" height="250"></canvas>
                <canvas id="myChartss" height="250"></canvas>
            </div>
            {% endif %}
          </div>
      </div>
    </div>

    <div style="margin-bottom: 80px;">

    </div>
    
    <!-- Navabar Bottom Start -->

    <div class="container container-nav-bottom">
        <nav class="nav nav-bottom">
          <a onclick="slideShow()" id="beranda" class="nav_link text-white">
            <i class="material-icons nav_icon">filter_alt</i>
            <span class="nav_text">Filter</span>
          </a>
        </nav>
    </div>

    <div id="slideup" class="panel">
        <div class="modal-header">
          <h5 class="modal-title">FILTER DATA</h5>
          <button onclick="slideHide()" type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="container" style="margin-top: 20px;">
          <form class="d-flex justify-content-center" href="/show-all-attend?date=date">
            <div class="form-row align-items-center">
              <div class="col-auto">
                <label class="mb-4">Tanggal</label>
              </div>
              <div class="col-auto">
                <input type="date" name="date" style="border-radius: 30px;" class="form-control mb-4" value="{{ datenow }}">
              </div>
              <div class="col-auto">
                <button type="submit" style="border-radius: 30px;" class="btn btn-primary mb-4">Terapkan</button>
              </div>
            </div>
          </form>
        <div class="d-flex justify-content-center">
            <li style="display: inline;">
                <a class="btn btn-primary btn-block" style="width:180px; border-radius: 30px;" href="/manager?date=now" role="button">Hari ini</a>
            </li>
            &nbsp;
            &nbsp;
            <li style="display: inline;">
                <a class="btn btn-primary btn-block" style="width:180px; border-radius: 30px;" href="/manager?date=all" role="button">Semua Data</a>
            </li>
          </div>
        </div>

        <div style="height: 30px;"></div>
    </div>

    <div id="slideups" class="panel">
      <div class="modal-header">
        <h5 class="modal-title">DETAIL</h5>
        <button onclick="slideHides()" type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="container" style="height: 350px; overflow-y: auto;">
        <div id="something"></div>
      </div>
    </div>

    <div id="backdrop" onclick="slideHide()"></div>
    <div id="backdrops" onclick="slideHides()"></div>

    <!-- Jumbotron Start -->

    <!-- Jumbotron End -->

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    {% load static %}
    <script>

    function getMember(elem) {
        const id = elem;
        
        $.ajax({
          url:window.location.pathname + id,
          type:'GET',
          contentType:'application/json; charset=utf-8',
          dataType:'json',
          success:function (result) {
            $('#something').html(`
            <div style='margin-top:10px'></div>
            <table class="table borderless">
              <tbody>
                <tr>
                  <td>Hasil Selfass</td>
                  <td>${result.attendance.selfass }</td>
                </tr>
                <tr>
                  <td>Status Kehadiran</td>
                  <td>${result.attendance.attendance }</td>
                </tr>
                <tr>
                  <td>Alasan Tidak Hadir</td>
                  <td>${result.attendance.reasonNotPresent }</td>
                </tr>
                <tr>
                  <td>Alasan Tidak Hadir Lainnya</td>
                  <td>${result.attendance.otherNotPresent }</td>
                </tr>
                <tr>
                  <td>Status Kesehatan</td>
                  <td>${result.attendance.condition}</td>
                </tr>
                <tr>
                  <td>Alasan Sakit</td>
                  <td>${result.attendance.sickChoices}</td>
                </tr>
                <tr>
                  <td>Alasan Sakit Lainnya</td>
                  <td>${result.attendance.otherSicks}</td>
                </tr>
                <tr>
                  <td>WFO/WFH</td>
                  <td>${result.attendance.work_status}</td>
                </tr>
                <tr>
                  <td>Waktu WFO</td>
                  <td>${result.attendance.wfo_description}</td>
                </tr>
                <tr>
                  <td>Tanggal Isi</td>
                  <td>${result.attendance.date_created}</td>
                </tr>
                <tr>
                  <td>Waktu Isi</td>
                  <td>${result.attendance.time_created}</td>
                </tr>
              </tbody>
            </table>
            `)
          },
          error: function (response) {
            console.log(response)
          }
        });
      }


        let kehadiran = document.getElementById('myCharts').getContext('2d');
        let myPieCharts  = new Chart(kehadiran, {
          type: 'pie',
          data: {
                labels: ['Hadir', 'Tidak Hadir'],
                datasets: [{
                    backgroundColor: ['#007bff','#f8f9fa'],
                    data: {{ attend }},
                }]
            },
          options: {
            title: {
              display : true,
              text : 'KEHADIRAN',
              position : 'bottom',
              fontSize : '18',
              fontColor : '#0275d8'
            }
          }
          });
  
        let ctxx = document.getElementById('myChartss').getContext('2d');
        let myPieChart  = new Chart(ctxx, {
          type: 'pie',
          data: {
                labels: ['Sehat', 'Sakit'],
                datasets: [{
                    backgroundColor: ['#007bff','#f8f9fa'],
                    data: {{ condition }},
                }]
            },
          options: {
            title: {
              display : true,
              text : 'KESEHATAN',
              position : 'bottom',
              fontSize : '18',
              fontColor : '#0275d8'
            }
          }
          });

        function slideShow(){
          jQuery('#slideup').slideDown(600);
          document.getElementById("backdrop").style.width = "100%";
          document.getElementById("backdrop").style.opacity = "0.5";    
        }

        function slideHide(){
          jQuery('#slideup').slideUp(600);
          document.getElementById("backdrop").style.width = "0";
          document.getElementById("backdrop").style.opacity = "0";
        }

        function slideShows(){
          jQuery('#slideups').slideDown(600);
          document.getElementById("backdrops").style.width = "100%";
          document.getElementById("backdrops").style.opacity = "0.5";    
        }

        function slideHides(){
          jQuery('#slideups').slideUp(600);
          document.getElementById("backdrops").style.width = "0";
          document.getElementById("backdrops").style.opacity = "0";
        }
      </script>
  </body>
</html>